# 易支付对接文档（复刻）

## 协议规则
- 请求数据格式：application/x-www-form-urlencoded
- 返回数据格式：JSON
- 签名算法：MD5
- 字符编码：UTF-8

---

## 页面跳转支付
- URL：`https://pay.liohg.top/submit.php`
- 请求方式：POST 或 GET（推荐 POST，不容易被劫持或屏蔽）

### 请求参数
| 字段名 | 变量名 | 必填 | 类型 | 示例值 | 描述 |
| --- | --- | --- | --- | --- | --- |
| 商户ID | pid | 是 | Int | 1001 | 商户 ID |
| 支付方式 | type | 否 | String | alipay | 参见“支付方式列表”；不传将跳转到收银台支付 |
| 商户订单号 | out_trade_no | 是 | String | 20160806151343349 | 商户内部订单号 |
| 异步通知地址 | notify_url | 是 | String | http://www.pay.com/notify_url.php | 服务器异步通知地址 |
| 跳转通知地址 | return_url | 是 | String | http://www.pay.com/return_url.php | 页面跳转通知地址 |
| 商品名称 | name | 是 | String | VIP会员 | 超过 127 个字符会自动截取 |
| 商品金额 | money | 是 | String | 1.00 | 单位：元，最多 2 位小数 |
| 业务扩展参数 | param | 否 | String | 留空 | 支付后原样返回 |
| 签名字符串 | sign | 是 | String | 202cb962ac59075b964b07152d234b70 | 签名结果 |
| 签名类型 | sign_type | 是 | String | MD5 | 默认 MD5 |

---

## API 接口支付
- URL：`https://pay.liohg.top/mapi.php`
- 请求方式：POST

### 请求参数
| 字段名 | 变量名 | 必填 | 类型 | 示例值 | 描述 |
| --- | --- | --- | --- | --- | --- |
| 商户ID | pid | 是 | Int | 1001 | 商户 ID |
| 支付方式 | type | 是 | String | alipay | 参见“支付方式列表” |
| 商户订单号 | out_trade_no | 是 | String | 20160806151343349 | 商户内部订单号 |
| 异步通知地址 | notify_url | 是 | String | http://www.pay.com/notify_url.php | 服务器异步通知地址 |
| 跳转通知地址 | return_url | 否 | String | http://www.pay.com/return_url.php | 页面跳转通知地址 |
| 商品名称 | name | 是 | String | VIP会员 | 超过 127 个字符会自动截取 |
| 商品金额 | money | 是 | String | 1.00 | 单位：元，最多 2 位小数 |
| 用户IP | clientip | 是 | String | 192.168.1.100 | 发起支付的用户 IP 地址 |
| 设备类型 | device | 否 | String | pc | 根据 UA 自动判断，或显式传入；默认 pc（见“设备类型列表”） |
| 业务扩展参数 | param | 否 | String | 留空 | 支付后原样返回 |
| 签名字符串 | sign | 是 | String | 202cb962ac59075b964b07152d234b70 | 签名结果 |
| 签名类型 | sign_type | 是 | String | MD5 | 默认 MD5 |

### 返回结果（JSON）
| 字段名 | 变量名 | 类型 | 示例值 | 描述 |
| --- | --- | --- | --- | --- |
| 返回状态码 | code | Int | 1 | 1 为成功，其他为失败 |
| 返回信息 | msg | String | ok | 失败时返回原因 |
| 订单号 | trade_no | String | 20160806151343349 | 支付订单号 |
| 支付跳转 url | payurl | String | https://pay.liohg.top/pay/wxpay/202010903/... | 返回该字段时，直接跳转到该 url 支付 |
| 二维码链接 | qrcode | String | weixin://wxpay/bizpayurl?pr=... | 返回该字段时，可根据 url 生成二维码 |
| 小程序跳转 url | urlscheme | String | weixin://dl/business/?ticket=xxx | 返回该字段时，使用跳转 url 发起小程序支付 |

注：`payurl`、`qrcode`、`urlscheme` 三个参数只会返回其中一个。

---

## 支付结果通知
- 通知类型：服务器异步通知（notify_url）、页面跳转通知（return_url）
- 请求方式：GET

### 请求参数
| 字段名 | 变量名 | 必填 | 类型 | 示例值 | 描述 |
| --- | --- | --- | --- | --- | --- |
| 商户ID | pid | 是 | Int | 1001 | 商户 ID |
| 易支付订单号 | trade_no | 是 | String | 20160806151343349021 | 支付平台订单号 |
| 商户订单号 | out_trade_no | 是 | String | 20160806151343349 | 商户内部订单号 |
| 支付方式 | type | 是 | String | alipay | 参见“支付方式列表” |
| 商品名称 | name | 是 | String | VIP会员 | — |
| 商品金额 | money | 是 | String | 1.00 | 单位：元 |
| 支付状态 | trade_status | 是 | String | TRADE_SUCCESS | 仅当值为 `TRADE_SUCCESS` 表示成功 |
| 业务扩展参数 | param | 否 | String | 留空 | 支付后原样返回 |
| 签名字符串 | sign | 是 | String | 202cb962ac59075b964b07152d234b70 | 签名结果 |
| 签名类型 | sign_type | 是 | String | MD5 | 默认 MD5 |

### 回执要求
- 异步通知收到并处理成功后，须返回字符串 `success` 表示服务器已接收并校验通过。

---

## MD5 签名算法
1. 将提交或收到的所有参数按 ASCII 码从小到大排序（a-z），`sign`、`sign_type` 以及空值不参与签名。
2. 将排序后的参数按 URL 键值对的格式拼接，例如：`a=b&c=d&e=f`，参数值不要进行 url 编码。
3. 将拼接好的字符串与商户密钥 `KEY` 进行 MD5 加密得到签名参数，`sign = md5(拼接串 + KEY)`（注意为字符串拼接，md5 结果为小写）。
4. 签名类型默认为 MD5。

---

## 支付方式列表
| 调用值 | 描述 |
| --- | --- |
| alipay | 支付宝 |
| wxpay | 微信支付 |

---

## 设备类型列表
| 调用值 | 描述 |
| --- | --- |
| pc | 电脑浏览器 |
| mobile | 手机浏览器 |
| qq | 手机 QQ 内浏览器 |
| wechat | 微信内浏览器 |
| alipay | 支付宝客户端 |
| jump | 仅返回支付跳转 url |

---

## [API] 查询结算记录
- URL：`https://pay.liohg.top/api.php?act=settle&pid={商户ID}&key={商户密钥}`

### 请求参数
| 字段名 | 变量名 | 必填 | 类型 | 示例值 | 描述 |
| --- | --- | --- | --- | --- | --- |
| 操作类型 | act | 是 | String | settle | 此 API 固定值 |
| 商户ID | pid | 是 | Int | 1001 | 商户 ID |
| 商户密钥 | key | 是 | String | 89unJUB8HZ54Hj7x4nUj56HN4nUzUJ8i | 商户密钥 |

### 返回结果
| 字段名 | 变量名 | 类型 | 示例值 | 描述 |
| --- | --- | --- | --- | --- |
| 返回状态码 | code | Int | 1 | 1 为成功，其它为失败 |
| 返回信息 | msg | String | 查询结算记录成功！ | 结果提示 |
| 结算记录 | data | Array | 结算记录列表 | 结算记录数组 |

---

## [API] 查询商户信息
- URL：`https://pay.liohg.top/api.php?act=query&pid={商户ID}&key={商户密钥}`

### 请求参数
| 字段名 | 变量名 | 必填 | 类型 | 示例值 | 描述 |
| --- | --- | --- | --- | --- | --- |
| 操作类型 | act | 是 | String | query | 此 API 固定值 |
| 商户ID | pid | 是 | Int | 1001 | 商户 ID |
| 商户密钥 | key | 是 | String | 89unJUB8HZ54Hj7x4nUj56HN4nUzUJ8i | 商户密钥 |

### 返回结果
| 字段名 | 变量名 | 类型 | 示例值 | 描述 |
| --- | --- | --- | --- | --- |
| 返回状态码 | code | Int | 1 | 1 为成功，其它为失败 |
| 商户ID | pid | Int | 1001 | 商户 ID |
| 商户密钥 | key | String(32) | 89unJUB8HZ54Hj7x4nUj56HN4nUzUJ8i | 商户密钥 |
| 商户状态 | active | Int | 1 | 1 为正常，0 为封禁 |
| 商户余额 | money | String | 0.00 | 商户所拥有的余额 |
| 结算方式 | type | Int | 1 | 1:支付宝, 2:微信, 3:QQ, 4:银行卡 |
| 结算账号 | account | String | admin@pay.com | 结算的支付账号 |
| 结算姓名 | username | String | 张三 | 结算账户姓名 |
| 订单总数 | orders | Int | 30 | 订单总数统计 |
| 今日订单 | order_today | Int | 15 | 今日订单数量 |
| 昨日订单 | order_lastday | Int | 15 | 昨日订单数量 |